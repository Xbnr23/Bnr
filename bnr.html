<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Upload Test</title>
</head>
<body>
    <h1>تسجيل ورفع الفيديو</h1>
    <video id="cameraStream" autoplay muted style="width: 100%; height: auto;"></video>
    <br>
    <button id="startRecording">بدء التسجيل</button>
    <button id="stopRecording" disabled>إيقاف التسجيل</button>
    <p id="status">الحالة: لم يبدأ التسجيل بعد.</p>

    <script>
        let mediaRecorder;
        let recordedChunks = [];

        // تشغيل الكاميرا
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('cameraStream').srcObject = stream;

                // إعداد MediaRecorder
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
                    uploadVideo(videoBlob); // رفع الفيديو
                };
            } catch (error) {
                alert("فشل الوصول إلى الكاميرا!");
                console.error("Error accessing camera:", error);
            }
        }

        // بدء التسجيل
        function startRecording() {
            if (mediaRecorder) {
                recordedChunks = [];
                mediaRecorder.start();
                document.getElementById('status').innerText = "الحالة: التسجيل قيد التشغيل...";
                document.getElementById('startRecording').disabled = true;
                document.getElementById('stopRecording').disabled = false;
            }
        }

        // إيقاف التسجيل
        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
                document.getElementById('status').innerText = "الحالة: تم إيقاف التسجيل.";
                document.getElementById('startRecording').disabled = false;
                document.getElementById('stopRecording').disabled = true;
            }
        }

        // رفع الفيديو إلى الخادم
        async function uploadVideo(videoBlob) {
            try {
                const formData = new FormData();
                formData.append("video", videoBlob, "recorded-video.webm");

                const response = await fetch("https://webhook.site/f6e1298e-571f-4b18-83df-956054a21163", { // استبدل your-server.com بالخادم الخاص بك
                    method: "POST",
                    body: formData,
                });

                if (response.ok) {
                    document.getElementById('status').innerText = "الحالة: تم رفع الفيديو بنجاح!";
                } else {
                    document.getElementById('status').innerText = "الحالة: فشل رفع الفيديو.";
                }
            } catch (error) {
                console.error("Error uploading video:", error);
                document.getElementById('status').innerText = "الحالة: حدث خطأ أثناء رفع الفيديو.";
            }
        }

        // إضافة الأحداث للأزرار
        document.getElementById('startRecording').addEventListener('click', startRecording);
        document.getElementById('stopRecording').addEventListener('click', stopRecording);

        // تشغيل الكاميرا عند فتح الصفحة
        startCamera();
    </script>
</body>
</html>
